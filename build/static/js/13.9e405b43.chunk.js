(this["webpackJsonpreact-app-ts"]=this["webpackJsonpreact-app-ts"]||[]).push([[13],{149:function(e,A,t){"use strict";t.d(A,"a",(function(){return r}));var n=t(487);function r(e){console.log("err___________",e),"undefined"!==typeof e.response?n.b.error(e.response.data.message):n.b.error("\u0110\xe3 c\xf3 l\u1ed7i s\u1ea3y ra, b\u1ea1n vui l\xf2ng th\u1eed l\u1ea1i sau")}},189:function(e,A,t){"use strict";t.d(A,"a",(function(){return c}));var n=t(37);var r=t(50);function c(e){return function(e){if(Array.isArray(e))return Object(n.a)(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Object(r.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},482:function(e,A,t){},502:function(e,A,t){"use strict";t.r(A);var n=t(1),r=t(25),c=t(31),a=t(6),s=function(e){var A=e.message,t=e.profilesChat,s=Object(r.c)((function(e){return e.userState.user})),i=Object(n.useCallback)((function(e,n){var r,s;if((null===(r=A[e+1])||void 0===r?void 0:r.sender)===(null===(s=A[e])||void 0===s?void 0:s.sender))return Object(a.jsx)("div",{});var i=t.findIndex((function(e){return e._id===n}));return i<0?Object(a.jsx)("img",{src:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4QBaRXhpZgAATU0AKgAAAAgAAgESAAMAAAABAAEAAIdpAAQAAAABAAAAJgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAA2aADAAQAAAABAAAA3wAAAAAAAP/bAEMACQYHCAcGCQgHCAoKCQsNFg8NDAwNGxQVEBYgHSIiIB0fHyQoNCwkJjEnHx8tPS0xNTc6OjojKz9EPzhDNDk6N//bAEMBCgoKDQwNGg8PGjclHyU3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3N//AABEIAN8A2QMBIgACEQEDEQH/xAAbAAEAAwEBAQEAAAAAAAAAAAAAAQIFBgQDB//EADIQAQABAwIEBAQFBAMAAAAAAAABAgMRBDEFEiFRIkFxkhMVU2EyMzRygRQkQlKRoaL/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/xAAWEQEBAQAAAAAAAAAAAAAAAAAAEQH/2gAMAwEAAhEDEQA/AP0QBpAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOu0dZaGl4VcuxzX6uSO0bgz8wZh0Nrh2ntx+Dm9X1jT2Po0+0o5nJu6SvRaeqMTZp/h49RwiiqJmzOPtJRji9y1XYqmi5RyyoAAAAAAAAAAAAAAAAAAAD0aCz/UaiKY6xHWQaHCtDy0xevRmudmnG5EYjER0jollUgAIlIDzarS0am3NNUdfKXPXrddm5NFXk6llcZsZoi9EY5d1GQH3FQAAAAAAAAAAAAAAAAavArf5lyfPZleTc4LH9nHfKDRARQAAAES+Ostxc01ymez7q1RmmYnzgHKR27C1yIi7XEeUqtIAAAAAAAAAAAAAAAANzgn6T+WG1eB3YxXbzt1RWwIzCUAAAABFXSJmUvPrbkW9NcqmcdMA5yuc3rk95lU67yNIAAAAAAAAAAAAAAAATs+2jvTp9RRXG20viA6umqKoiqPNZjcJ1sUR8C9V+2WxmGVSIicpABGYAnZj8a1HWizROe73a3VU6eifF452hz1dddy5NdW8rmCOvmAqAAAAAAAAAAAAAAAAAAG7Q0XFKrUcmo8VMbVM8xkHTWdRauxE0V0y+2Y3cnETGy3xLkRiLtfuSK6iqummM1VYeDU8Vt0RNNnxVsWqqqqMVTn1qRiI26EFrty5er57k9VQaxABAAAAAAAAAAAAAAAMwvatV36uS1GZa2l4VboxXf8dfbyBlWrNy9+XRVP8A09dvhN+vrVy0tummKelMYj7JjdKrIjg1fnex6LfJp+vV7WuFGR8mn69XtPk0/Xq9rXCjI+TT9er2nyafr1e1rhRjzwaryvf+Xzq4PeiM03KZbiJ6lHNXtFqLX4qMx9nwnp0no6ucvNqdDZ1EeKjE94KOdHp1miuaac8uaO7zKgAAAAAAAAAA+2n09eouRRR7nxiJmeWneXRaDS06a1EcvjneTRfS6WjTW+SiPWe77wlGYZVIjMGYBIhIAhIAIBIIzAJROxmDMArXTTVTNNcZiWHxDQTYnntdbfbs3p/5VqopqpmmqMxIOV8sj067TTpr0x/hVs8zSAAAAAAAE7A0OEWIu3vi1R0phtZ6vLwy1FrR0R36vQmqtkzCogtmDMKgLZMqgLZMqgLZMqgLZMwqAtmDMKgLZM91QHn4nYi/p5mN4YGOno6iesY79HNaij4V+5R91xHzAUAAAADGZiPuJjePWAdHZ8NmintC+VKZ8EeiQWyZVIBbJlGYMwCcmUZgkE5MqkAtkyiUAtkyqAtkyqAtkyqgF8sTitPLq5nvGWyyOL/qo/YDwgAAAAAHnHrAA6On8uJ+xl8NDdm5p4zvEPuBkyAGTIAZMgBkyAGTIAZMgBkyAGTIAZZPFpidTGP9GrM4jPZhau5N3UV1/wAA+QAAAP/Z",alt:"Avt",width:25,height:25}):Object(a.jsx)("img",{src:"".concat(c.b).concat(t[i].avatar),alt:"Avt",width:25,height:25})}),[t,A]),u=Object(n.useCallback)((function(e){var t,n;return(null===(t=A[e+1])||void 0===t?void 0:t.sender)===(null===(n=A[e])||void 0===n?void 0:n.sender)?Object(a.jsx)("div",{}):Object(a.jsx)("img",{src:"".concat(c.b).concat(null===s||void 0===s?void 0:s.avatar),alt:"Avt",width:25,height:25})}),[s,A]),o=Object(n.useCallback)((function(e){var t,n,r,c,a,s,i,u;return(null===(t=A[e+1])||void 0===t?void 0:t.sender)!==(null===(n=A[e])||void 0===n?void 0:n.sender)&&(null===(r=A[e-1])||void 0===r?void 0:r.sender)!==(null===(c=A[e])||void 0===c?void 0:c.sender)?"message-t-b":(null===(a=A[e-1])||void 0===a?void 0:a.sender)!==(null===(s=A[e])||void 0===s?void 0:s.sender)?"message-t":(null===(i=A[e+1])||void 0===i?void 0:i.sender)!==(null===(u=A[e])||void 0===u?void 0:u.sender)?"message-b":"message-c"}),[A]);return Object(a.jsx)("div",{className:"flex flex-col px-5",children:A.map((function(e,A){return Object(a.jsx)("div",{className:"flex ".concat(e.sender!==(null===s||void 0===s?void 0:s._id)?"":"justify-end"),children:e.sender!==(null===s||void 0===s?void 0:s._id)?Object(a.jsxs)("div",{className:"flex items-end flex-row w-70pc not-sender-smg",children:[Object(a.jsx)("div",{className:"avatar-sender mr-2",children:i(A,e.sender)}),Object(a.jsx)("div",{className:"flex-1 flex",children:Object(a.jsx)("p",{className:"bg-gray-500 text-white px-2 py-1 my-1px  ".concat(o(A)),children:e.content})})]}):Object(a.jsxs)("div",{className:"flex justify-end items-end flex-row w-70pc sender-smg",children:[Object(a.jsx)("div",{className:"flex-1 flex justify-end mr-2",children:Object(a.jsx)("p",{className:"bg-blue-600 text-white px-2 py-1 my-1px ".concat(o(A)),children:e.content})}),Object(a.jsx)("div",{className:"avatar-sender",children:u(A)})]})},A)}))})},i=t(47),u=t(15),o=function(e){var A=e.listChat;return Object(a.jsx)("div",{children:Object(a.jsx)("div",{children:A.map((function(e){return Object(a.jsx)(i.b,{to:"".concat(u.g,"/").concat(e._id),children:Object(a.jsx)("div",{children:Object(a.jsx)("p",{children:e.name})})},e._id)}))})})},l=t(2),d=t.n(l),f=t(45),b=t(44),j=function(e){var A=e.sendMessage,t=Object(n.useState)(""),r=Object(b.a)(t,2),c=r[0],s=r[1];function i(){return(i=Object(f.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),A(c),s("");case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(a.jsxs)("form",{onSubmit:function(e){return i.apply(this,arguments)},className:"flex flex-row",children:[Object(a.jsx)("input",{value:c,onChange:function(e){return s(e.target.value)},placeholder:"Aa"}),Object(a.jsx)("button",{type:"submit",children:"Send"})]})},v=(t(482),t(46)),p=t(149),x=function(e){var A=Object(n.useState)(),t=Object(b.a)(A,2),r=t[0],c=t[1];return Object(n.useEffect)((function(){function A(){return(A=Object(f.a)(d.a.mark((function A(){var t;return d.a.wrap((function(A){for(;;)switch(A.prev=A.next){case 0:return A.prev=0,A.next=3,v.a.user.getChatMessage(e);case 3:t=A.sent,c(t.data),A.next=10;break;case 7:A.prev=7,A.t0=A.catch(0),Object(p.a)(A.t0);case 10:case"end":return A.stop()}}),A,null,[[0,7]])})))).apply(this,arguments)}!function(){A.apply(this,arguments)}()}),[e]),{chat:r}},m=t(189),h=t(265),O=function(e){var A=Object(h.b)(),t=Object(r.c)((function(e){return e.userState.user})),c=Object(n.useState)([]),a=Object(b.a)(c,2),s=a[0],i=a[1],u=Object(n.useMemo)((function(){return["".concat(h.a,"/").concat(null===t||void 0===t?void 0:t._id)]}),[null===t||void 0===t?void 0:t._id]),o=Object(n.useCallback)((function(){A.on("message",function(){var A=Object(f.a)(d.a.mark((function A(t,n){var r;return d.a.wrap((function(A){for(;;)switch(A.prev=A.next){case 0:(r=JSON.parse(n.toString())).chat===e&&i((function(e){return[].concat(Object(m.a)(e),[r.m])}));case 2:case"end":return A.stop()}}),A)})));return function(e,t){return A.apply(this,arguments)}}())}),[e,A]);Object(n.useEffect)((function(){return A.subscribe(u,(function(e){e&&console.log("Subscribe to topics error",e)})),function(){A.unsubscribe(u)}}),[null===t||void 0===t?void 0:t._id,A,u]),Object(n.useEffect)((function(){o()}),[o]);var l=Object(n.useCallback)(Object(f.a)(d.a.mark((function A(){var t;return d.a.wrap((function(A){for(;;)switch(A.prev=A.next){case 0:return A.prev=0,A.next=3,v.a.user.getMessage(e);case 3:t=A.sent,i(t.data),A.next=10;break;case 7:A.prev=7,A.t0=A.catch(0),Object(p.a)(A.t0);case 10:case"end":return A.stop()}}),A,null,[[0,7]])}))),[e]);return Object(n.useEffect)((function(){l()}),[l]),{message:s,sendMessage:Object(n.useCallback)(function(){var A=Object(f.a)(d.a.mark((function A(t){return d.a.wrap((function(A){for(;;)switch(A.prev=A.next){case 0:t&&v.a.user.sendMessage(e,{content:t});case 1:case"end":return A.stop()}}),A)})));return function(e){return A.apply(this,arguments)}}(),[e])}},g=function(e){var A=Object(n.useState)([]),t=Object(b.a)(A,2),r=t[0],c=t[1],a=Object(n.useCallback)(Object(f.a)(d.a.mark((function A(){var t;return d.a.wrap((function(A){for(;;)switch(A.prev=A.next){case 0:if(!e){A.next=5;break}return A.next=3,Promise.all(e.member.map(function(){var e=Object(f.a)(d.a.mark((function e(A){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.a.user.getUser(A.idUser,"fullname avatar");case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})));return function(A){return e.apply(this,arguments)}}()));case 3:t=A.sent,c(t);case 5:case"end":return A.stop()}}),A)}))),[e]);return Object(n.useEffect)((function(){a()}),[a]),{profilesChat:r}},N=function(){var e=Object(n.useState)([]),A=Object(b.a)(e,2),t=A[0],r=A[1];return Object(n.useEffect)((function(){function e(){return(e=Object(f.a)(d.a.mark((function e(){var A;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,v.a.user.getListChat();case 3:A=e.sent,r(A.data),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),Object(p.a)(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),{listChat:t}};A.default=function(e){var A=Object(n.useRef)(null),t=e.match.params.id,r=x(t).chat,c=N().listChat,i=O(t),u=i.message,l=i.sendMessage,d=g(r).profilesChat;return Object(n.useEffect)((function(){!function(){var e;null===(e=A.current)||void 0===e||e.scrollIntoView()}()}),[u]),Object(a.jsxs)("div",{className:"chat h-full flex-1 flex flex-nowrap",children:[Object(a.jsx)("div",{className:"h-full w-80 border-r border-solid border-slate-500",children:Object(a.jsx)(o,{listChat:c})}),Object(a.jsxs)("div",{className:"h-full w-full flex-col flex",children:[Object(a.jsx)("div",{className:"flex h-20 w-full border-b border-solid border-slate-500",children:Object(a.jsx)("div",{children:null===r||void 0===r?void 0:r.name})}),Object(a.jsxs)("div",{className:"flex-1 overflow-auto border-r border-solid border-slate-500 flex-row-reverse",children:[Object(a.jsx)(s,{message:u,profilesChat:d}),Object(a.jsx)("div",{ref:A})]}),Object(a.jsx)("div",{className:"overflow-hidden border-t border-solid border-slate-500 py-4 px-2",children:Object(a.jsx)(j,{sendMessage:l})})]})]})}}}]);
//# sourceMappingURL=13.9e405b43.chunk.js.map