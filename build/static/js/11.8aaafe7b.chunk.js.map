{"version":3,"sources":["components/Error.tsx","screens/chat/message/Message.tsx","img/avatar_default.jpg","screens/chat/ChatList.tsx","screens/chat/message/SendMessage.tsx","screens/chat/hooks/useChatBox.ts","utils/mqtt.ts","screens/chat/hooks/useMessage.ts","screens/chat/hooks/useMemer.ts","screens/chat/hooks/useChatList.ts","screens/chat/index.tsx"],"names":["errorAPI","error","console","log","response","message","data","Message","props","profilesChat","user","useSelector","s","userState","getAvtImg","useCallback","index","id","sender","i","findIndex","u","_id","src","alt","width","height","BASE_URL_IMG","avatar","getAvtImgSender","getClassMess","className","map","mess","content","ChatList","listChat","lChat","to","MESSAGE","name","SendMessage","sendMessage","useState","setContent","e","a","preventDefault","onSubmit","value","onChange","target","placeholder","type","useChatBox","chat","setChat","useEffect","API","getChatMessage","res","getChat","mqttClient","mqtt","clean","connectTimeout","reconnectPeriod","useMessage","setMessage","subscribe","on","topic","JSON","toString","parse","m","concat","getMessage","useMember","setProfilesChat","getProfiles","Promise","all","member","getUser","idUser","profiles","useChatList","setListChat","getListChat","Chat","messagesEndRef","useRef","match","params","current","scrollIntoView","scrollToBottom","ref"],"mappings":"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","file":"static/js/11.8aaafe7b.chunk.js","sourcesContent":["import { message } from \"antd\";\r\nexport function errorAPI(error: any) {\r\n    console.log(\"err___________\", error);\r\n    if (typeof error.response === \"undefined\") {\r\n        message.error(\"Đã có lỗi sảy ra, bạn vui lòng thử lại sau\");\r\n        return;\r\n    }\r\n    message.error(error.response.data.message);\r\n}\r\n","import { useCallback } from \"react\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { BASE_URL_IMG } from \"../../../config\";\r\nimport { MessageInterface, UserInterface } from \"../../../interface\";\r\nimport { AppState } from \"../../../interface/redux\";\r\nimport AvatarDefault from \"../../../img/avatar_default.jpg\";\r\ntype MessageProps = {\r\n    message: MessageInterface[];\r\n    profilesChat: UserInterface[];\r\n};\r\nconst Message = (props: MessageProps) => {\r\n    const { message, profilesChat } = props;\r\n    const user = useSelector((s: AppState) => s.userState.user);\r\n\r\n    const getAvtImg = useCallback(\r\n        (index: number, id: string) => {\r\n            if (message[index + 1]?.sender === message[index]?.sender) {\r\n                return <div></div>;\r\n            }\r\n\r\n            const i = profilesChat.findIndex(\r\n                (u: UserInterface) => u._id === id\r\n            );\r\n            if (i < 0) {\r\n                return (\r\n                    <img src={AvatarDefault} alt=\"Avt\" width={25} height={25} />\r\n                );\r\n            } else {\r\n                return (\r\n                    <img\r\n                        src={`${BASE_URL_IMG}${profilesChat[i].avatar}`}\r\n                        alt=\"Avt\"\r\n                        width={25}\r\n                        height={25}\r\n                    />\r\n                );\r\n            }\r\n        },\r\n        [profilesChat, message]\r\n    );\r\n    const getAvtImgSender = useCallback(\r\n        (index: number) => {\r\n            if (message[index + 1]?.sender === message[index]?.sender) {\r\n                return <div></div>;\r\n            }\r\n\r\n            return (\r\n                <img\r\n                    src={`${BASE_URL_IMG}${user?.avatar}`}\r\n                    alt=\"Avt\"\r\n                    width={25}\r\n                    height={25}\r\n                />\r\n            );\r\n        },\r\n        [user, message]\r\n    );\r\n    const getClassMess = useCallback(\r\n        (index: number) => {\r\n            if (\r\n                message[index + 1]?.sender !== message[index]?.sender &&\r\n                message[index - 1]?.sender !== message[index]?.sender\r\n            ) {\r\n                return \"message-t-b\";\r\n            }\r\n            if (message[index - 1]?.sender !== message[index]?.sender) {\r\n                return \"message-t\";\r\n            }\r\n            if (message[index + 1]?.sender !== message[index]?.sender) {\r\n                return \"message-b\";\r\n            }\r\n\r\n            return \"message-c\";\r\n        },\r\n        [message]\r\n    );\r\n    return (\r\n        <div className=\"flex flex-col px-5\">\r\n            {message.map(\r\n                (mess: MessageInterface, index: number) => (\r\n                    <div\r\n                        className={`flex ${\r\n                            mess.sender !== user?._id ? \"\" : \"justify-end\"\r\n                        }`}\r\n                        key={index}\r\n                    >\r\n                        {mess.sender !== user?._id ? (\r\n                            <div className=\"flex items-end flex-row w-70pc not-sender-smg\">\r\n                                <div className=\"avatar-sender mr-2\">\r\n                                    {getAvtImg(index, mess.sender)}\r\n                                </div>\r\n                                <div className=\"flex-1 flex\">\r\n                                    <p\r\n                                        className={`bg-gray-500 text-white px-2 py-1 my-1px  ${getClassMess(\r\n                                            index\r\n                                        )}`}\r\n                                    >\r\n                                        {mess.content}\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"flex justify-end items-end flex-row w-70pc sender-smg\">\r\n                                <div className=\"flex-1 flex justify-end mr-2\">\r\n                                    <p\r\n                                        className={`bg-blue-600 text-white px-2 py-1 my-1px ${getClassMess(\r\n                                            index\r\n                                        )}`}\r\n                                    >\r\n                                        {mess.content}\r\n                                    </p>\r\n                                </div>\r\n\r\n                                <div className=\"avatar-sender\">\r\n                                    {getAvtImgSender(index)}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                )\r\n                // ) : (\r\n                //     <div className=\"flex justify-end my-1\" key={index}></div>\r\n                // )\r\n            )}\r\n        </div>\r\n    );\r\n};\r\nexport default Message;\r\n","export default \"data:image/jpeg;base64,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\"","import { Link } from \"react-router-dom\";\r\nimport { ChatListInterFace } from \"../../interface/api/UserAPI\";\r\nimport { MESSAGE } from \"../../router/const\";\r\n\r\ntype ChatListProps = {\r\n    listChat: ChatListInterFace[];\r\n};\r\nconst ChatList = (props: ChatListProps) => {\r\n    const { listChat } = props;\r\n    return (\r\n        <div>\r\n            <div>\r\n                {listChat.map((lChat: ChatListInterFace) => (\r\n                    <Link key={lChat._id} to={`${MESSAGE}/${lChat._id}`}>\r\n                        <div>\r\n                            <p>{lChat.name}</p>\r\n                        </div>\r\n                    </Link>\r\n                ))}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\nexport default ChatList;\r\n","import React, { useState } from \"react\";\r\n\r\ntype SendMessageProps = {\r\n    sendMessage: (content: string) => Promise<void>;\r\n};\r\n\r\nconst SendMessage = (props: SendMessageProps) => {\r\n    const { sendMessage } = props;\r\n    const [content, setContent] = useState(\"\");\r\n    async function subbmit(e: React.FormEvent<HTMLFormElement>) {\r\n        e.preventDefault();\r\n        sendMessage(content);\r\n        setContent(\"\");\r\n    }\r\n    return (\r\n        <form onSubmit={subbmit} className=\"flex flex-row\">\r\n            <input\r\n                value={content}\r\n                onChange={(e) => setContent(e.target.value)}\r\n                placeholder=\"Aa\"\r\n            />\r\n            <button type=\"submit\">Send</button>\r\n        </form>\r\n    );\r\n};\r\nexport default SendMessage;\r\n","import { useEffect, useState } from \"react\";\r\nimport API from \"../../../api\";\r\nimport { errorAPI } from \"../../../components/Error\";\r\nimport { ChatInterface } from \"../../../interface\";\r\n\r\nconst useChatBox = (_id: any) => {\r\n    const [chat, setChat] = useState<ChatInterface>();\r\n\r\n    useEffect(() => {\r\n        async function getChat() {\r\n            try {\r\n                const res = await API.user.getChatMessage(_id);\r\n                setChat(res.data);\r\n            } catch (e) {\r\n                errorAPI(e);\r\n            }\r\n        }\r\n        getChat();\r\n    }, [_id]);\r\n\r\n    return { chat };\r\n};\r\nexport default useChatBox;\r\n","import * as mqtt from \"mqtt\";\r\nconst MQTT = \"ws://20.212.16.22:9001\";\r\nexport const TOPIC_MESSAGE = \"message\";\r\n\r\nconst mqttClient = mqtt.connect(MQTT, {\r\n    clean: true,\r\n    connectTimeout: 4000,\r\n    reconnectPeriod: 1000,\r\n});\r\n\r\nexport default mqttClient;\r\n","import { useCallback, useEffect, useState } from \"react\";\r\nimport API from \"../../../api\";\r\nimport { errorAPI } from \"../../../components/Error\";\r\nimport { MessageInterface } from \"../../../interface\";\r\nimport mqttClient, { TOPIC_MESSAGE } from \"../../../utils/mqtt\";\r\n\r\nconst useMessage = (_id: any) => {\r\n    const [message, setMessage] = useState<MessageInterface[]>([]);\r\n\r\n    useEffect(() => {\r\n        mqttClient.subscribe([`${TOPIC_MESSAGE}/${_id}`], (error: any) => {\r\n            if (error) {\r\n                console.log(\"Subscribe to topics error\", error);\r\n                return;\r\n            }\r\n        });\r\n    }, [_id]);\r\n\r\n    mqttClient.on(\"message\", async function (topic: any, mess: any) {\r\n        const m: MessageInterface = await JSON.parse(await mess.toString());\r\n        setMessage(message.concat(m));\r\n    });\r\n    const getMessage = useCallback(async () => {\r\n        try {\r\n            const res = await API.user.getMessage(_id);\r\n            setMessage(res.data);\r\n        } catch (e) {\r\n            errorAPI(e);\r\n        }\r\n    }, [_id]);\r\n\r\n    useEffect(() => {\r\n        getMessage();\r\n    }, [getMessage]);\r\n\r\n    const sendMessage = useCallback(\r\n        async (content: string) => {\r\n            if (content) {\r\n                const res = await API.user.sendMessage(_id, {\r\n                    content: content,\r\n                });\r\n                setMessage(message.concat(res.data));\r\n            }\r\n        },\r\n        [_id, message]\r\n    );\r\n\r\n    return { message, sendMessage };\r\n};\r\nexport default useMessage;\r\n","import { useCallback, useEffect, useState } from \"react\";\r\nimport API from \"../../../api\";\r\nimport {\r\n    ChatInterface,\r\n    MemberInterface,\r\n    UserInterface,\r\n} from \"../../../interface\";\r\n\r\nconst useMember = (chat: ChatInterface | undefined) => {\r\n    const [profilesChat, setProfilesChat] = useState<UserInterface[]>([]);\r\n    const getProfiles = useCallback(async () => {\r\n        if (chat) {\r\n            const profiles = await Promise.all(\r\n                chat.member.map(async (m: MemberInterface) => {\r\n                    const res = await API.user.getUser(\r\n                        m.idUser,\r\n                        \"fullname avatar\"\r\n                    );\r\n                    return res.data;\r\n                })\r\n            );\r\n            setProfilesChat(profiles);\r\n        }\r\n    }, [chat]);\r\n    useEffect(() => {\r\n        getProfiles();\r\n    }, [getProfiles]);\r\n\r\n    return { profilesChat };\r\n};\r\nexport default useMember;\r\n","import { useEffect, useState } from \"react\";\r\nimport API from \"../../../api\";\r\nimport { errorAPI } from \"../../../components/Error\";\r\nimport { ChatListInterFace } from \"../../../interface/api/UserAPI\";\r\n\r\nconst useChatList = () => {\r\n    const [listChat, setListChat] = useState<ChatListInterFace[]>([]);\r\n\r\n    useEffect(() => {\r\n        async function getListChat() {\r\n            try {\r\n                const res = await API.user.getListChat();\r\n                setListChat(res.data);\r\n            } catch (e) {\r\n                errorAPI(e);\r\n            }\r\n        }\r\n        getListChat();\r\n    }, []);\r\n\r\n    return { listChat };\r\n};\r\nexport default useChatList;\r\n","import Message from \"./message/Message\";\r\nimport ChatList from \"./ChatList\";\r\nimport SendMessage from \"./message/SendMessage\";\r\nimport \"./style.scss\";\r\nimport useChatBox from \"./hooks/useChatBox\";\r\nimport useMessage from \"./hooks/useMessage\";\r\n\r\nimport { useEffect, useRef } from \"react\";\r\nimport useMember from \"./hooks/useMemer\";\r\nimport useChatList from \"./hooks/useChatList\";\r\n\r\nconst Chat = (props: any) => {\r\n    const messagesEndRef = useRef<null | HTMLDivElement>(null);\r\n    const _id = props.match.params.id;\r\n    const { chat } = useChatBox(_id);\r\n    const { listChat } = useChatList();\r\n    const { message, sendMessage } = useMessage(_id);\r\n    const { profilesChat } = useMember(chat);\r\n    const scrollToBottom = () => {\r\n        messagesEndRef.current?.scrollIntoView();\r\n    };\r\n\r\n    useEffect(() => {\r\n        scrollToBottom();\r\n    }, [message]);\r\n\r\n    return (\r\n        <div className=\"chat h-full flex-1 flex flex-nowrap\">\r\n            <div className=\"h-full w-80 border-r border-solid border-slate-500\">\r\n                <ChatList listChat={listChat} />\r\n            </div>\r\n            <div className=\"h-full w-full flex-col flex\">\r\n                <div className=\"flex h-20 w-full border-b border-solid border-slate-500\">\r\n                    <div>{chat?.name}</div>\r\n                </div>\r\n                <div className=\"flex-1 overflow-auto border-r border-solid border-slate-500 flex-row-reverse\">\r\n                    <Message message={message} profilesChat={profilesChat} />\r\n                    <div ref={messagesEndRef} />\r\n                </div>\r\n                <div className=\"overflow-hidden border-t border-solid border-slate-500 py-4 px-2\">\r\n                    <SendMessage sendMessage={sendMessage} />\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\nexport default Chat;\r\n"],"sourceRoot":""}